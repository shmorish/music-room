# Music Room 要件定義書

## 概要
**プロジェクト名**: Music Room  
**バージョン**: 5.3  
**サブタイトル**: Music, Collaboration and mobility  
**目的**: 音楽とユーザーエクスペリエンスに焦点を当てた完全なモバイルソリューションの作成

## 1. 序文

### 1.1 音楽体験について
音楽の「消費」は、誰もが自分なりの方法で体験する個人的な体験である：

- 日常的に音楽に囲まれる
- 友人と時間を共有するときに音楽を楽しむ
- 一人になったり集中するために音楽を使う
- パフォーマンス、ライブショー、フェスティバルのみを信じる

## 2. プロジェクトの目標

このプロジェクトは、実際の製品の制約を考慮し、モバイル、接続、協調的なアプリケーションの作成に必要なすべての概念に取り組むことを目的とする。

以下の作業が必要：
- ソリューションのクライアント/サーバーアーキテクチャの構築
- データストレージの決定
- サーバーとクライアント間の通信チャネルとして使用されるAPIの定義
- ランプアップとセキュリティの問題の予測
- 第三者との協働、外部SDKの統合

### 実装必須サービス
以下のサービスを実装する必要がある：

1. **Music Track Vote** - 投票機能付きライブ音楽チェーン
2. **Music Control Delegation** - 音楽制御の委譲
3. **Music Playlist Editor** - リアルタイムマルチユーザープレイリスト編集

**⚠️ 注意**: 選択するSDKが作業を代行してはならない。

## 3. 一般的な指示

### 3.1 ソフトウェアアーキテクチャに関する指示

- バックエンドで使用する戦略や言語に制約はない
- さまざまな利用可能技術の利点と欠点を評価し、プロジェクトに最適なものを特定する
- 決定を正当化する必要がある
- 自分で書いていないライブラリをリポジトリにコミットしてはならない
- プロジェクトの依存関係は、Makefileまたは類似のメカニズムによりリポジトリのクローンから自動的にダウンロード可能でなければならない

### 3.2 モバイルエクスペリエンスに関する指示

- モバイルアプリケーションはプロジェクトに関連するすべての必要なアクションをユーザーが実行できるようにする必要がある
- AndroidまたはiOSのどちらかで実装可能
- 任意の技術を使用可能

## 4. 必須部分

### 4.1 ユーザー管理

#### アカウント作成
- 初回実行時にアカウント作成が必要
- メール/パスワードまたはソーシャルネットワークアカウント（FacebookまたはGoogle）での登録を選択

#### ソーシャル連携
- プラットフォームにアカウントを持つユーザーは、ネットワークアカウント（FacebookまたはGoogle）をリンク可能

#### プロフィール管理
ユーザーは以下を設定・更新可能：
- 公開情報
- 友人のみに公開される情報  
- プライベート情報
- 音楽の好み

#### セキュリティ機能
- メール/パスワードでアカウント作成した場合：
  - メール検証が必要
  - パスワード忘れ時の変更機能提供

### 4.2 サービス

アプリケーションでは、以下の3つの機能のうち少なくとも2つにアクセスできる必要がある：
Music Track Vote、Music Playlist Editor、Music Control Delegation

#### 4.2.1 Music Track Vote（音楽トラック投票）

**機能概要**: 投票機能付きライブ音楽チェーン

**詳細**:
- パーティーやイベントなどで人々が集まった場合のサービス
- 現在のプレイリストの次のトラックを誰でも提案・投票可能
- 多くの票を集めたトラックは、リストで上位に移動し、早めに再生される

**公開設定管理**:
- デフォルトでイベントは公開
- イベントが公開の場合、すべてのユーザーがイベントを見つけて投票可能
- イベントがプライベートの場合、招待ユーザーのみがイベントを見つけて投票可能

**ライセンス管理**:
- デフォルトで全員が投票可能
- 適切なライセンスがある場合、招待された人のみが投票可能
- 適切なライセンスがある場合、特定の場所の特定時間（例：午後4時から6時）にいる人のみが投票可能

**⚠️ 注意**: 競合問題の管理に特に注意が必要（複数の人が異なるトラックや同じトラックに投票する場合など）

#### 4.2.2 Music Control Delegation（音楽制御委譲）

**機能概要**: 音楽制御の委譲

**詳細**:
- ユーザーアカウントに接続された各デバイスに固有のライセンス管理が必要
- ユーザーは異なる友人に音楽制御を与えることを選択可能

#### 4.2.3 Music Playlist Editor（音楽プレイリストエディター）

**機能概要**: リアルタイムマルチユーザープレイリスト

**詳細**:
- 友人や同じ音楽的嗜好を持つ人々とリアルタイムでプレイリストを作成するために協力
- ユーザーはオリジナルのラジオステーションを作成可能

**公開設定管理**:
- デフォルトでプレイリストは公開
- 公開の場合、すべてのユーザーがプレイリストにアクセス可能
- プライベートの場合、招待されたユーザーのみがプレイリストにアクセス可能

**ライセンス管理**:
- デフォルトで全員がプレイリストを編集可能
- 適切なライセンスがある場合、招待されたユーザーのみがプレイリストを編集可能

**⚠️ 注意**: 競合問題の管理に特に注意が必要（複数の人が異なるトラックや同じトラックを移動する場合など）

### 4.3 サーバー

- すべてのサービスデータはバックエンド側に保存
- バックエンドが基準となり、「真実」の保管者および代表者
- 任意の技術とフレームワークを使用可能（php、nodejs、golang、firebaseなど）

### 4.4 API

**概要**:
- すべてのアプリケーションのバックエンドへのアクセスポイント
- 他の開発者が様々なコンテキスト統合でAPIを活用
- APIに関するドキュメントが必須

**要件**:
- メソッド、入力、出力を紹介するAPIリファレンスドキュメントが必要
- Swaggerなどで自動生成可能
- RESTの原則を支持するAPIを作成（他の選択肢もあるが、選択を正当化し特徴を説明する必要がある）
- 交換フォーマットにはJSONを推奨（他の選択肢もあるが、選択を正当化し特徴を説明する必要がある）

### 4.5 モバイルアプリケーション

**要件**:
- アプリケーションはバックエンドへの「リモートコントロール」のみ
- テスト用にバックエンドのアドレスをアプリケーションで設定可能
- ソーシャルネットワーク（FacebookまたはGoogle）による認証サポートを実装
- リソースは developers.facebook.com および developers.google.com で利用可能

### 4.6 セキュリティ

**要件**:
- 認証されたユーザーは自分のデータにアクセス可能だが、他のユーザーのデータにはアクセス不可
- 悪意のある行動（APIへのブルートフォース攻撃、セッション盗難など）を計画する必要がある
- APIが破られないことは期待されていないが：
  - ユーザーを保護するメカニズムを実装する必要がある
  - 他の危険を特定し、実行可能な保護について説明する必要がある

**ログ記録**:
モバイルアプリケーションでのあらゆるアクションがバックエンドでログを生成する必要がある：
- プラットフォーム（Android、iOSなど）
- デバイス（iPhone 6G、iPad Air、Samsung Edgeなど）
- アプリケーションバージョン

### 4.7 ランプアップ

**要件**:
- APIとバックエンドがサポートできる負荷を評価できる必要がある
- 3つのサービスを同時に使用できるユーザー数を正当化し測定する
- AB（Apache Benchmark）、Gatling、Siege、Tsung、JMeterなどを使用可能

**考慮事項**:
- サーバー特性（CPU、RAM、クラウドまたはプレミス等）を指定する必要がある
- 最大ユーザー数はプラットフォーム選択と一致している必要がある
- Raspberry Piの場合は数十、低スペックサーバーの場合は数千

### 4.8 アジリティ、品質、継続的インテグレーション

**要件**:
- チームでの作業のため、多くの層と機能を実装する必要がある
- アジリティを示し、自分の決定を疑問視し、各層に対して特定の一回限りのテストを設定する必要がある

**⚠️ セキュリティ要件**:
明らかなセキュリティ理由により、すべての認証情報、APIキー、環境変数などは.envファイルにローカルに保存し、gitで無視する必要がある。公開されて保存された認証情報は、プロジェクトの直接的な失敗につながる。

## 5. ボーナス部分

ここで提案されているボーナスは、モバイルアプリケーション開発時に直面する実際のビジネス問題と一致している。

### 5.1 マルチプラットフォームサポート

- サーバーと機能的なAPIを持っている場合、様々なプラットフォームでサービスを利用可能にできる
- すでにモバイルプラットフォーム（AndroidまたはiOS）をサポートしている必要がある
- ボーナスとして、任意の画面サイズに適応できるWebサービス「レスポンシブ」も作成可能
- 技術選択によっては、Webサポートでクライアントコードの完全またはほぼ完全な書き換えが必要な場合がある

### 5.2 IoTへの反映

- イベントにiBeaconなどのメカニズムを実装可能
- サービスに登録された公開イベントに人々が近づくと、自動的にイベントに関する情報、アクセス方法、音楽の種類などを受信

### 5.3 無料サブスクリプション vs 有料サブスクリプション

- 現在のWebソリューションとモバイルアプリケーションは、無料制限サブスクリプションといくつかの無制限有料サブスクリプションをユーザーが選択できることが多い
- アプリケーションでこの種のロジックを実装可能
- 事前に確立された2つのオファーをユーザーが切り替えられるようにする必要がある
- アプリケーションの一部の機能（Music Playlist Editorなど）は有料サブスクリプションのユーザーのみが利用可能

<!--
### 5.4 オフラインモード

- モバイルサービスがない場合など、ユーザーがアプリケーションをオフラインで楽しめるメカニズムを実装
- オフラインで使用する場合、アプリケーションが提供する体験と機能は完全に異なる場合がある
- アプリケーションがオフラインで使用される場合、同期を計画する必要がある
-->

**注意事項**:
同期メカニズムには問題が伴う：
- 競合と並行性の管理
- モバイルアプリケーション上の廃止データの管理

**⚠️ 重要**: ボーナス部分は必須部分が完璧な場合にのみ評価される。完璧とは必須部分が完全に完了し、誤動作なく動作することを意味する。すべての必須要件を満たしていない場合、ボーナス部分は一切評価されない。

## 6. 提出とピア評価

通常通りGitリポジトリに課題を提出する。ディフェンス中に評価されるのはリポジトリ内の作業のみ。フォルダとファイルの名前が正しいことを確認するため、二重チェックすることをためらわないこと。

---

## 技術選択の考慮事項

### バックエンド技術候補
- Node.js

### モバイル開発技術候補
- Flutter

### データベース候補
- MySQL

## 開発チーム役割分担の推奨

- バックエンドAPI開発者
- モバイルアプリ開発者
- UI/UXデザイナー
    - figma?
- DevOps/インフラ担当者
    - elk

## リスク管理

### 技術リスク
- 外部SDK依存による制約
- パフォーマンス要件の充足
- セキュリティ脆弱性

### プロジェクトリスク
- チーム間の連携不足
- 要件変更への対応
- 開発スケジュールの遅延

## 成功基準

### 必須要件
- 3つのサービスのうち2つが正常に動作
- モバイルアプリとバックエンドAPIの完全な統合
- ユーザー認証とセキュリティ機能の実装
- API ドキュメントの完備

### 品質基準
- 同時接続ユーザー数の目標達成
- レスポンス時間の要件充足
- セキュリティテストの通過
- コードの可読性と保守性
